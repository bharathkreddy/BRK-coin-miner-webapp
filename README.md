# BRK COIN MINER
## Example of microservices run on dockerized containers. 

#### This application is to demonstrate usage of docker to run microservices. This demo uses a miner application of fictitious coin called BRK coin. The application uses python, nodejs, redis, and ruby code - all of which is orchestrated using docker. I demonstrate running this using simple docker commands and then the same application using orchestrators like Docker swarm and kubernetes.  

**ARCHITECTURE**

![architecture](https://github.com/bharathkreddy/docker-coins-webapp/blob/main/dockercoins-diagram.svg?raw=true)


The application consists of below components
1. rng - a random number generator. This is a python scritp to generates a random number. This file uses Flask framework to allow worker to read the number using GET method.
2. hasher - A ruby program which takes the random number generated by rng and converts that to a SHA2 hash.
3. redis - is a key value pair inmemory database, this database keeps a track of how many coins the miner has found. It acts like a wallet for our BRK coins.
4. worker - is the brains of the application, this python code works as below
    - Fethes the random number from rng by GET request exposed by Flask framework. 
    - PUT request is sent to the hasher.
    - Value of Hash generated is read and if he hash starts with the integer 0, this is called a BRK coin. 
    - On finding a BRK coin the values in REDIS which acts as the coin wallet are incremented.
5. webui - is a graphical interface to see the entire application in action. This is written in nodejs and shows the live collection of BRK coins.

The entire application is written to be very modular. Follow below steps to run the BRK miner to mine some BRK coins. 

*Setting up the environment variables so creation of docker images & networks can be run in a loop.*

```
github_branch=Main
github_repository=docker-coins-webapp
github_username=bharathkreddy
dockerid=bharathreddy26
```
```
git clone https://github.com/${github_username}/${github_repository}
cd ${github_repository}/
git checkout ${github_branch}
```
```
for app in hasher rng webui worker
do
  docker build --file ${app}/Dockerfile --tag ${dockerid}/${app}:brkcoin .
done
```
```
for app in hasher redis rng
do
  docker network create ${app}
done
```
```
docker volume create redis
```
```
docker run --detach --name redis --network redis --read-only --restart always --volume redis:/data/:rw library/redis:alpine
```
```
docker run --detach --entrypoint ruby --name hasher --network hasher --read-only --restart always --volume ${PWD}/hasher/hasher.rb:/hasher.rb:ro ${github_username}/${github_repository}:${github_branch}-hasher hasher.rb
```
```
docker run --detach --entrypoint python --name rng --network rng --read-only --restart always --volume /usr/local/lib/python3.10/http/__pycache__/ --volume /usr/local/lib/python3.10/__pycache__/ --volume ${PWD}/rng/rng.py:/rng.py:ro ${github_username}/${github_repository}:${github_branch}-rng rng.py
```
```
docker run --detach --entrypoint python --name worker --network redis --read-only --restart always --volume /usr/local/lib/python3.10/distutils/__pycache__/ --volume ${PWD}/worker/worker.py:/worker.py:ro ${github_username}/${github_repository}:${github_branch}-worker worker.py
```
```
for network in hasher rng
do
  docker network connect ${network} worker
done
```
```
docker run --detach --entrypoint node --name webui --network redis --publish 8080 --read-only --restart always --volume ${PWD}/webui/webui.js:/webui.js:ro --volume ${PWD}/webui/files/:/files/:ro ${github_username}/${github_repository}:${github_branch}-webui webui.js
```
